<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Report Action -->
    <report
            id="action_report_billing"
            model="ip.part.billing"
            string="IP Billing Report"
            report_type="qweb-pdf"
            name="homeo_doctor.report_billing_pdf"
            file="homeo_doctor.report_billing_pdf"
            print_report_name="'Billing Report'"
    />

    <!-- Report Template -->
    <template id="report_billing_pdf">
        <t t-name="homeo_doctor.report_billing_pdf">
            <t t-call="web.basic_layout">
                <div class="page">

                    <p style="color: blue;">Debug data:
                        <t t-esc="data"/>
                    </p>

                    <t t-if="data">
                        <t t-set="from_date" t-value="data.get('from_date')"/>
                        <t t-set="to_date" t-value="data.get('to_date')"/>
                        <t t-set="model_name" t-value="data.get('model_name')"/>
                        <t t-set="record_ids" t-value="data.get('record_ids') or []"/>
                        <t t-set="records" t-value="env[model_name].browse(record_ids)"/>

                        <h2 style="text-align:center;">Billing Report</h2>
                        <p>From:
                            <t t-esc="from_date"/>
                            — To:
                            <t t-esc="to_date"/>
                        </p>

                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Bill No</th>
                                    <th>Patient</th>
                                    <th>Date</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-if="not records">
                                    <tr>
                                        <td colspan="4">No records found.</td>
                                    </tr>
                                </t>
                                <t t-foreach="records" t-as="rec">
                                    <tr>
                                        <td>
                                            <t t-esc="rec.bill_number or rec.patient_id or rec.id"/>
                                        </td>
                                        <td>
                                            <t t-esc="rec.patient_name or rec.name"/>
                                        </td>
                                        <td>
                                            <t t-esc="rec.bill_date or rec.discharge_date"/>
                                        </td>
                                        <td>
                                            <t t-esc="rec.net_amount or rec.total_amount or 0"/>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </t>

                    <t t-if="not data">
                        <p style="color:red;">❌ No data received</p>
                    </t>

                </div>
            </t>
        </t>
    </template>
</odoo>
